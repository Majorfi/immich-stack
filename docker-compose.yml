version: "3.8"

services:
  immich-stack:
    container_name: immich_stack
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - API_KEY=${API_KEY}
      - API_URL=${API_URL:-http://immich-server:2283/api}
      - DRY_RUN=${DRY_RUN:-false}
      - RESET_STACKS=${RESET_STACKS:-false}
      - CONFIRM_RESET_STACK=${CONFIRM_RESET_STACK} # Required for RESET_STACKS. Must be set to: 'I acknowledge all my current stacks will be deleted and new one will be created'
      - REPLACE_STACKS=${REPLACE_STACKS:-false}
      - PARENT_FILENAME_PROMOTE=${PARENT_FILENAME_PROMOTE:-edit}
      - PARENT_EXT_PROMOTE=${PARENT_EXT_PROMOTE:-.jpg,.dng}
      - WITH_ARCHIVED=${WITH_ARCHIVED:-false}
      - WITH_DELETED=${WITH_DELETED:-false}
      - RUN_MODE=${RUN_MODE:-once}
      - CRON_INTERVAL=${CRON_INTERVAL:-86400}
      - LOG_LEVEL=${LOG_LEVEL:-info} # Options: trace, debug, info, warn, error
      - LOG_FORMAT=${LOG_FORMAT:-text} # Options: text, json
      - LOG_FILE=${LOG_FILE} # Optional: Set to /app/logs/immich-stack.log to enable file logging
    volumes:
      - ./logs:/app/logs # Mount for log files when LOG_FILE is set
    restart: on-failure
